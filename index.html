<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 å°å¤§ç”Ÿå·¥ç‡Ÿ | æ­£å¼ç‰ˆ</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- è¨­è¨ˆç³»çµ± --- */
        :root {
            --primary: #2AB7CA; 
            --primary-dark: #239cb0;
            --secondary: #76C95A; 
            --accent: #FF9F1C; 
            --urgent: #e63946;
            --bg: #F4F7F6;
            --text: #333;
            --card-bg: #FFFFFF;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg); color: var(--text);
            margin: 0; padding: 0; padding-bottom: 90px; overflow-x: hidden;
        }

        .container { padding: 20px; max-width: 600px; margin: 0 auto; }
        .card {
            background: var(--card-bg); border-radius: 16px; padding: 20px;
            margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.02); position: relative;
        }

        /* ğŸš¨ å…¬å‘Šç‰¹æ•ˆ */
        .card.urgent { border: 2px solid var(--urgent); animation: border-pulse 2s infinite; }
        @keyframes border-pulse { 0% { border-color: var(--urgent); } 50% { border-color: #ffb3b8; } 100% { border-color: var(--urgent); } }

        /* æŒ‰éˆ•èˆ‡ Input */
        .btn { background: var(--primary); color: white; border: none; padding: 12px; border-radius: 12px; font-size: 16px; font-weight: bold; width: 100%; cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 8px; }
        .btn:active { transform: scale(0.98); }
        .btn-secondary { background: var(--secondary); }
        .back-btn { background: none; border: none; font-size: 16px; color: #666; cursor: pointer; margin-bottom: 10px; display: flex; align-items: center; gap: 5px; }
        
        /* Loading */
        #loading-mask { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); z-index: 8000; display: none; justify-content: center; align-items: center; flex-direction: column; }
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, var(--primary), var(--secondary)); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
        .login-box { background: white; width: 100%; max-width: 320px; padding: 30px; border-radius: 24px; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        .login-input { width: 100%; padding: 12px; margin-bottom: 12px; border: 2px solid #eee; border-radius: 10px; font-size: 16px; outline: none; }

        /* è¡Œç¨‹è¡¨ */
        .day-tabs { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 10px; scrollbar-width: none; }
        .day-tab { background: white; color: #888; padding: 8px 16px; border-radius: 20px; font-size: 14px; white-space: nowrap; border: 1px solid #eee; cursor: pointer; }
        .day-tab.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 4px 10px rgba(42, 183, 202, 0.3); }
        .schedule-item { display: flex; align-items: flex-start; gap: 15px; padding: 15px; border-radius: 12px; background: white; margin-bottom: 12px; }
        .time-badge { background: rgba(42, 183, 202, 0.1); color: var(--primary); padding: 5px 8px; border-radius: 6px; font-weight: bold; font-size: 14px; min-width: 65px; text-align: center; }

        /* ğŸ† æ’è¡Œæ¦œå„ªåŒ–æ¨£å¼ */
        .score-row { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee; }
        .score-row:last-child { border-bottom: none; }
        .rank-badge { width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; margin-right: 10px; font-size: 14px; background: #eee; color: #666; }
        
        .rank-1 .rank-badge { background: #FFD700; color: #fff; box-shadow: 0 2px 5px rgba(255, 215, 0, 0.4); }
        .rank-2 .rank-badge { background: #C0C0C0; color: #fff; }
        .rank-3 .rank-badge { background: #CD7F32; color: #fff; }
        
        .score-bar-bg { flex: 1; height: 8px; background: #f0f0f0; border-radius: 4px; overflow: hidden; margin: 0 15px; }
        .score-bar-fill { height: 100%; background: var(--secondary); border-radius: 4px; transition: width 1s ease-out; }
        .score-num { font-weight: bold; font-size: 16px; min-width: 40px; text-align: right; color: var(--primary); }

        /* åº•éƒ¨å°èˆª */
        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -5px 20px rgba(0,0,0,0.05); z-index: 1000; }
        .nav-item { text-align: center; font-size: 10px; color: #bbb; width: 20%; cursor: pointer; transition: 0.2s; }
        .nav-item.active { color: var(--primary); transform: translateY(-3px); }
        .nav-icon { font-size: 20px; display: block; margin-bottom: 4px; }

        .page { display: none; animation: fadeIn 0.3s forwards; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="login-overlay">
        <div class="login-box">
            <h2 style="color: var(--primary); margin-top: 0;">2026 å°å¤§ç”Ÿå·¥ç‡Ÿ</h2>
            <p style="color: #888; font-size: 14px; margin-bottom: 20px;">è«‹è¼¸å…¥å§“åèˆ‡å­¸å“¡ç·¨è™Ÿ</p>
            <input type="text" id="loginName" class="login-input" placeholder="å­¸å“¡å§“å">
            <input type="text" id="loginID" class="login-input" placeholder="å­¸å“¡ç·¨è™Ÿ">
            <button class="btn" onclick="handleLogin()">é€²å…¥ç‡ŸéšŠç³»çµ±</button>
        </div>
    </div>

    <div id="loading-mask">
        <i class="fas fa-spinner fa-spin" style="font-size: 40px; color: var(--primary); margin-bottom: 15px;"></i>
        <p>æ­£åœ¨åŒæ­¥é›²ç«¯è³‡æ–™...</p>
    </div>

    <div id="app-container" style="display: none;">
        
        <div id="home" class="page active container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h2 style="margin: 0;">Hi, <span id="user-name">å­¸å“¡</span> ğŸ‘‹</h2>
                <div onclick="toggleDevMode()" style="cursor:pointer; padding:5px;"><i class="fas fa-clock" style="color:#ddd;"></i></div>
            </div>

            <div class="card" style="background: linear-gradient(135deg, var(--primary), #4DD0E1); color: white;">
                <div style="background: rgba(255,255,255,0.2); display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 12px; margin-bottom: 10px;">ç¾åœ¨ç‹€æ…‹</div>
                <h3 id="home-status-title" style="margin: 0 0 5px 0; font-size: 24px;">è¼‰å…¥ä¸­...</h3>
                <p id="home-status-time" style="margin: 0; opacity: 0.9;">--:--</p>
            </div>

            <h3 style="margin-bottom: 10px; font-size: 18px;">ğŸ“¢ ç‡ŸéšŠå…¬å‘Š</h3>
            <div id="announcement-container"></div>
        </div>

        <div id="schedule" class="page container">
            <h2>ğŸ“… æ´»å‹•æ—¥ç¨‹</h2>
            <div class="day-tabs" id="day-tabs"></div>
            <div id="schedule-list"></div>
        </div>

        <div id="activity" class="page container">
            <h2>ğŸ† æˆ°æ³æ’è¡Œæ¦œ</h2>
            <div class="card" style="padding-top: 10px;">
                <div id="scoreboard">è¼‰å…¥ä¸­...</div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="card" style="text-align: center; cursor: pointer;" onclick="alert('è«‹ä½¿ç”¨FirebaseåŠŸèƒ½é€£çµ')">
                    <i class="fas fa-flask" style="font-size: 30px; color: var(--primary); margin-bottom: 10px;"></i>
                    <h3 style="font-size: 14px; margin:0;">å¯¦é©—ç´€éŒ„</h3>
                </div>
                <div class="card" style="text-align: center; cursor: pointer;" onclick="alert('è«‹ä½¿ç”¨FirebaseåŠŸèƒ½é€£çµ')">
                    <i class="fas fa-comments" style="font-size: 30px; color: var(--accent); margin-bottom: 10px;"></i>
                    <h3 style="font-size: 14px; margin:0;">å°çµ„è¨è«–</h3>
                </div>
            </div>
        </div>

        <div id="info" class="page container">
            <h2>â„¹ï¸ å¯¦ç”¨è³‡è¨Š</h2>
            <div id="info-list"></div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active" onclick="switchPage('home', this)"><i class="fas fa-home nav-icon"></i>é¦–é </div>
        <div class="nav-item" onclick="switchPage('schedule', this)"><i class="fas fa-calendar-alt nav-icon"></i>è¡Œç¨‹</div>
        <div class="nav-item" onclick="switchPage('activity', this)"><i class="fas fa-trophy nav-icon"></i>æ´»å‹•</div>
        <div class="nav-item" onclick="switchPage('info', this)"><i class="fas fa-info-circle nav-icon"></i>è³‡è¨Š</div>
    </div>

    <script type="module">
        // Firebase ç›¸é—œè«‹ä¿æŒåŸæ¨£ (é€™è£¡çœç•¥ Firebase åˆå§‹åŒ–ä»¥å°ˆæ³¨æ–¼ Sheet å•é¡Œ)
        // æ‚¨çš„ Firebase config...

        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycby5gNCBcAO5ktMfLh1wU4ajjJJCDW8V1hx8ykzr7o6VJpqCLa6OFhiZxAw9JmpNsH4q/exec";

        let cachedData = JSON.parse(localStorage.getItem('bse_camp_data')) || null;
        let mockTime = null;
        let currentTabDay = "";

        // ğŸŒŸ å·¥å…·å‡½å¼ï¼šæ ¼å¼åŒ–æ™‚é–“ (è§£æ±ºæ™‚é–“è·‘æ‰å•é¡Œ)
        function formatTime(raw) {
            if (!raw) return "--:--";
            // å¦‚æœæ˜¯ Date ç‰©ä»¶æˆ–é•·å­—ä¸²
            let str = raw.toString();
            if (str.includes("T") || str.length > 8) {
                const date = new Date(raw);
                if (!isNaN(date.getTime())) {
                    // å–å‡º HH:mm
                    return date.getHours().toString().padStart(2, '0') + ":" + 
                           date.getMinutes().toString().padStart(2, '0');
                }
            }
            // å¦‚æœåŸæœ¬å°±æ˜¯ "09:00"
            return str.substring(0, 5);
        }

        // ğŸŒŸ å·¥å…·å‡½å¼ï¼šæ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(raw) {
            if(!raw) return "";
            const d = new Date(raw);
            return !isNaN(d.getTime()) ? (d.getMonth()+1) + "/" + d.getDate() : raw;
        }

        window.handleLogin = async function() {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('loading-mask').style.display = 'flex';
            document.getElementById('user-name').innerText = document.getElementById('loginName').value || "å­¸å“¡";
            
            await fetchData();
            
            document.getElementById('loading-mask').style.display = 'none';
            document.getElementById('app-container').style.display = 'block';
            renderAll();
        };

        async function fetchData() {
            try {
                const res = await fetch(GOOGLE_SCRIPT_URL);
                const data = await res.json();
                cachedData = data;
                localStorage.setItem('bse_camp_data', JSON.stringify(data));
                console.log("è³‡æ–™æ›´æ–°æˆåŠŸ", data);
            } catch (e) {
                console.error("é€£ç·šå¤±æ•—", e);
                if(!cachedData) alert("ç„¡æ³•é€£ç·šï¼Œè«‹æª¢æŸ¥ç¶²è·¯");
            }
        }

        function renderAll() {
            if (!cachedData) return;
            renderAnnouncements();
            renderScoreboard();
            renderInfo();
            initSchedule();
        }

        // 1. å…¬å‘Š
        function renderAnnouncements() {
            const list = cachedData.announcements || [];
            const container = document.getElementById('announcement-container');
            const active = list.filter(a => String(a.active).toLowerCase() === "true");

            if (active.length === 0) {
                container.innerHTML = `<div class="card" style="color:#888;">ç›®å‰ç„¡å…¬å‘Š</div>`;
                return;
            }

            container.innerHTML = active.map(a => {
                const isUrgent = String(a.urgent).toLowerCase() === "true";
                return `
                <div class="card ${isUrgent ? 'urgent' : ''}">
                    <h3 style="margin:0 0 5px 0; color:${isUrgent ? 'var(--urgent)' : 'var(--text)'};">
                        ${isUrgent ? 'ğŸš¨ ' : 'ğŸ“Œ '}${a.title}
                    </h3>
                    <p style="margin:0;">${a.content}</p>
                    <div style="font-size:12px; color:#aaa; margin-top:8px; text-align:right;">${formatDate(a.date)}</div>
                </div>`;
            }).join('');
        }

        // 2. è¡Œç¨‹ (æ‡‰ç”¨ formatTime)
        function initSchedule() {
            const list = cachedData.schedule || [];
            if(list.length === 0) return;

            const days = [...new Set(list.map(i => i.day))];
            if(!currentTabDay) currentTabDay = days[0];

            document.getElementById('day-tabs').innerHTML = days.map(d => 
                `<div class="day-tab ${d===currentTabDay?'active':''}" onclick="setTab('${d}')">${d}</div>`
            ).join('');
            
            const dayEvents = list.filter(i => i.day === currentTabDay);
            document.getElementById('schedule-list').innerHTML = dayEvents.map(e => `
                <div class="schedule-item">
                    <div class="time-badge">${formatTime(e.time)}</div>
                    <div>
                        <div style="font-weight:bold;">${e.title}</div>
                        <div style="font-size:13px; color:#888;">ğŸ“ ${e.loc}</div>
                    </div>
                </div>
            `).join('');

            updateHomeStatus();
        }

        window.setTab = function(d) {
            currentTabDay = d;
            initSchedule();
        }

        // 3. æˆ°æ³æ¿ (å„ªåŒ–æ’ç‰ˆ)
        function renderScoreboard() {
            let list = cachedData.scores || [];
            const container = document.getElementById('scoreboard');
            
            if(list.length === 0) {
                container.innerHTML = "å°šç„¡æˆ°æ³è³‡æ–™";
                return;
            }

            // æ’åºï¼šåˆ†æ•¸é«˜ -> ä½
            list.sort((a, b) => b.score - a.score);
            const maxScore = list[0].score || 100;

            container.innerHTML = list.map((s, index) => {
                const rankClass = index < 3 ? `rank-${index+1}` : '';
                return `
                <div class="score-row ${rankClass}">
                    <div class="rank-badge">${index + 1}</div>
                    <div style="font-weight:bold;">${s.id} å°</div>
                    <div class="score-bar-bg">
                        <div class="score-bar-fill" style="width: ${(s.score/maxScore)*100}%"></div>
                    </div>
                    <div class="score-num">${s.score}</div>
                </div>`;
            }).join('');
        }

        // 4. è³‡è¨Šé  (è§£æ±ºç©ºç™½å•é¡Œ)
        function renderInfo() {
            const list = cachedData.info || [];
            const container = document.getElementById('info-list');
            
            console.log("Info Data:", list); // Debugç”¨

            if (list.length === 0) {
                container.innerHTML = `<div style="text-align:center; color:#888;">æš«ç„¡è³‡è¨Š</div>`;
                return;
            }

            container.innerHTML = list.map(i => {
                // é˜²å‘†ï¼šå®¹è¨±æ¬„ä½åç¨±å¤§å°å¯«æ··ç”¨
                const title = i.title || i.Title || "æ¨™é¡Œ";
                const content = i.content || i.Content || "";
                const type = (i.type || i.Type || "").toLowerCase();
                const val = i.value || i.Value || "";

                let btnHtml = "";
                if (type === "tel" && val) {
                    btnHtml = `<button class="btn" onclick="location.href='tel:${val}'"><i class="fas fa-phone"></i> æ’¥æ‰“é›»è©±</button>`;
                } else if (type === "link" && val) {
                    btnHtml = `<button class="btn btn-secondary" onclick="window.open('${val}')"><i class="fas fa-link"></i> é–‹å•Ÿé€£çµ</button>`;
                }

                return `
                <div class="card">
                    <h3 style="margin:0 0 5px 0;">${title}</h3>
                    <p style="color:#555; margin:0 0 ${btnHtml?'15px':'0'} 0;">${content}</p>
                    ${btnHtml}
                </div>`;
            }).join('');
        }

        // æ›´æ–°é¦–é ç‹€æ…‹
        function updateHomeStatus() {
            const now = mockTime || new Date();
            // ... (ç‹€æ…‹åˆ¤æ–·é‚è¼¯åŒå‰)
            // é€™è£¡ç°¡åŒ–é¡¯ç¤º
            const h = now.getHours().toString().padStart(2,'0');
            const m = now.getMinutes().toString().padStart(2,'0');
            document.getElementById('home-status-time').innerText = `${h}:${m}`;
        }

        window.switchPage = function(pageId, el) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            if(el) el.classList.add('active');
        };

        window.toggleDevMode = function() {
            const t = prompt("è¨­å®šæ™‚é–“ (1/26 14:00)");
            if(t) {
                mockTime = new Date(`2026/${t}:00`);
                renderAll();
            }
        };
    </script>
</body>
</html>
